Лучшие практики (best practices)

1. Всегда добавляйте default к необязательным переменным
{{ some_var | default('not set') }}

2. Не пишите "гигантский монолитный шаблон" — делите на куски
{% include 'header.j2' %}
{% include 'server-block.j2' %}

3. Выводите YAML или JSON внутри шаблона для отладки
{{ my_dict | to_nice_yaml }}

4. Используйте шаблоны для генерации "однотипных" сущностей
Например: множество systemd юнитов, множество nginx server-блоков, множество cron-записей.

5. Храните шаблоны в каталоге templates/ в роли или проекте.

Частые ошибки и как их избежать
Ошибка                                   	Как избежать
Шаблон падает: переменной нет            	Используйте default()
Цикл не работает                         	Проверьте, что переменная — список
Ошибка в include: переменная не передаётся 	Убедитесь, что шаблон подключается в нужном контексте цикла
Не видно что выводится                   	Добавьте to_nice_yaml или временные {{ ... }}
Перемешались отступы в шаблоне           	Работайте с конфигами строго как с текстом — и следите за пробелам